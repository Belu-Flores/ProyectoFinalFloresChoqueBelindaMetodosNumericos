<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Análisis Numérico Aplicado</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <style>
      :root {
        --color-primary: #6a1b9a; /* Morado Oscuro */
        --color-accent: #ab47bc; /* Morado Medio */
        --color-light: #f4f0f6; /* Fondo Lavanda Claro */
        --color-text: #212121;
        --color-white: #ffffff;
      }
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--color-light);
        color: var(--color-text);
      }
      header {
        background-color: var(--color-primary);
        color: var(--color-white);
        padding: 20px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
      }
      .section {
        background-color: var(--color-white);
        padding: 30px;
        margin-bottom: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-left: 5px solid var(--color-accent);
      }
      h2 {
        color: var(--color-primary);
        border-bottom: 2px solid var(--color-accent);
        padding-bottom: 10px;
        margin-top: 0;
      }
      .input-group {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 20px;
      }
      .input-item {
        display: flex;
        flex-direction: column;
        min-width: 150px;
      }
      label {
        font-weight: bold;
        margin-bottom: 5px;
        color: var(--color-primary);
      }
      input[type="number"],
      input[type="text"],
      button {
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #ccc;
      }
      button {
        background-color: var(--color-accent);
        color: var(--color-white);
        border: none;
        cursor: pointer;
        transition: background-color 0.3s ease;
        font-weight: bold;
        margin-top: 15px;
      }
      button:hover {
        background-color: #9c27b0;
      }
      .results {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid var(--color-light);
        background-color: var(--color-light);
        border-radius: 4px;
      }
      .results p {
        margin: 5px 0;
        font-weight: bold;
      }
      .equation {
        font-style: italic;
        background-color: #e1bee7;
        padding: 8px;
        border-radius: 4px;
        text-align: center;
        margin: 15px 0;
        font-weight: bold;
        color: var(--color-primary);
      }
      .canvas-container {
        max-width: 100%;
        height: 400px;
        margin-top: 20px;
      }
      /* Estilo específico para la tabla de Gauss-Seidel */
      .matrix-input {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-bottom: 20px;
      }
      .matrix-input input {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Análisis Numérico Aplicado</h1>
      <p>Ejemplos Funcionales de Métodos Numéricos</p>
    </header>

    <div class="container">
      <div id="ode-section" class="section">
        <h2>1. Simulación de Crecimiento Asintótico (Euler vs. Heun)</h2>
        <div class="equation">
          Problema de Crecimiento (Ejercicio 41):
          <i>dm/dt = k * m^(3/4) * [1 - (m/m_max)^(1/4)]</i>
        </div>

        <div class="input-group">
          <div class="input-item">
            <label for="ode-k">Constante k (0.3):</label>
            <input type="number" id="ode-k" value="0.3" step="0.01" />
          </div>
          <div class="input-item">
            <label for="ode-mmax">Masa Máxima (300):</label>
            <input type="number" id="ode-mmax" value="300" />
          </div>
          <div class="input-item">
            <label for="ode-m0">Masa Inicial (m0):</label>
            <input type="number" id="ode-m0" value="1" />
          </div>
          <div class="input-item">
            <label for="ode-h">Paso (h):</label>
            <input type="number" id="ode-h" value="1" step="1" />
          </div>
          <div class="input-item">
            <label for="ode-tfinal">Tiempo Final (tf):</label>
            <input type="number" id="ode-tfinal" value="400" />
          </div>
        </div>

        <button onclick="solveODE()">Calcular y Graficar Crecimiento</button>

        <div class="canvas-container">
          <canvas id="odeChart"></canvas>
        </div>

        <div class="results" id="ode-results">
          <p>Resultados (t = <span id="ode-t-final">0</span>):</p>
          <p>Heun (m_final): <span id="heun-result">--</span></p>
          <p>Euler (m_final): <span id="euler-result">--</span></p>
        </div>
      </div>

      <div id="bisection-section" class="section">
        <h2>2. Cálculo de Raíz por Bisección (Punto de Equilibrio)</h2>
        <div class="equation">
          Problema Práctico: Encontrar la raíz de
          <i>f(x) = x³ - 7x² + 14x - 6</i>
        </div>

        <div class="input-group">
          <div class="input-item">
            <label for="bisect-a">Límite Inferior (a):</label>
            <input type="number" id="bisect-a" value="0" step="0.1" />
          </div>
          <div class="input-item">
            <label for="bisect-b">Límite Superior (b):</label>
            <input type="number" id="bisect-b" value="1" step="0.1" />
          </div>
          <div class="input-item">
            <label for="bisect-tol">Tolerancia (e):</label>
            <input type="number" id="bisect-tol" value="0.0001" step="0.0001" />
          </div>
          <div class="input-item">
            <label for="bisect-maxit">Máx. Iteraciones:</label>
            <input type="number" id="bisect-maxit" value="50" />
          </div>
        </div>

        <button onclick="solveBisection()">Encontrar Raíz</button>

        <div class="results" id="bisection-results">
          <p>Raíz Encontrada (c): <span id="bisection-root">--</span></p>
          <p>Iteraciones: <span id="bisection-iter">--</span></p>
        </div>
      </div>

      <div id="gauss-seidel-section" class="section">
        <h2>3. Corrientes en Circuito Eléctrico (Gauss-Seidel)</h2>
        <p>Resolver el sistema lineal <i>AX=B</i> (ejemplo 3x3):</p>
        <div class="equation">
          Ejemplo: <i>4x₁ - x₂ = 10</i> &nbsp; | &nbsp;
          <i>-x₁ + 4x₂ - x₃ = 8</i> &nbsp; | &nbsp; <i>-x₂ + 4x₃ = 6</i>
        </div>

        <div class="matrix-input">
          <div
            style="grid-column: 1 / 5; font-weight: bold; text-align: center"
          >
            Matriz A y Vector B (3x3)
          </div>
          <input type="number" id="a11" value="4" />
          <input type="number" id="a12" value="-1" />
          <input type="number" id="a13" value="0" />
          <input type="number" id="b1" value="10" placeholder="b1" />
          <input type="number" id="a21" value="-1" />
          <input type="number" id="a22" value="4" />
          <input type="number" id="a23" value="-1" />
          <input type="number" id="b2" value="8" placeholder="b2" />
          <input type="number" id="a31" value="0" />
          <input type="number" id="a32" value="-1" />
          <input type="number" id="a33" value="4" />
          <input type="number" id="b3" value="6" placeholder="b3" />
        </div>

        <div class="input-group">
          <div class="input-item">
            <label for="gs-tol">Tolerancia (e):</label>
            <input type="number" id="gs-tol" value="0.0001" step="0.0001" />
          </div>
          <div class="input-item">
            <label for="gs-maxit">Máx. Iteraciones:</label>
            <input type="number" id="gs-maxit" value="25" />
          </div>
        </div>

        <button onclick="solveGaussSeidel()">Resolver Sistema</button>

        <div class="results" id="gs-results">
          <p>x₁ (Corriente 1): <span id="gs-x1">--</span></p>
          <p>x₂ (Corriente 2): <span id="gs-x2">--</span></p>
          <p>x₃ (Corriente 3): <span id="gs-x3">--</span></p>
          <p>Iteraciones: <span id="gs-iter">--</span></p>
        </div>
      </div>
    </div>
    <script>
      // =========================================================
      // 1. MÉTODOS DE EULER Y HEUN (EDOs) - EJERCICIO 41
      // =========================================================
      const f_ode = (m, k, mmax) => {
        const exp1 = 0.75; // 3/4
        const exp2 = 0.25; // 1/4
        if (m < 0) return 0; // Prevenir errores con log/potencias de números negativos
        return k * Math.pow(m, exp1) * (1 - Math.pow(m / mmax, exp2));
      };

      let odeChartInstance = null;

      function solveODE() {
        const k = parseFloat(document.getElementById("ode-k").value);
        const mmax = parseFloat(document.getElementById("ode-mmax").value);
        let m0 = parseFloat(document.getElementById("ode-m0").value);
        const h = parseFloat(document.getElementById("ode-h").value);
        const tFinal = parseFloat(document.getElementById("ode-tfinal").value);

        if (
          isNaN(k) ||
          isNaN(mmax) ||
          isNaN(m0) ||
          isNaN(h) ||
          isNaN(tFinal) ||
          h <= 0
        ) {
          alert(
            "Por favor, ingrese valores numéricos válidos. El paso 'h' debe ser positivo."
          );
          return;
        }

        const N = Math.floor(tFinal / h);
        let t = [0];
        let mEuler = [m0];
        let mHeun = [m0];

        for (let i = 0; i < N; i++) {
          const t_i = t[i];

          // --- Método de Euler ---
          const k1_euler = f_ode(mEuler[i], k, mmax);
          const m_i_euler = mEuler[i] + k1_euler * h;
          mEuler.push(m_i_euler);

          // --- Método de Heun ---
          // Predictor (k1)
          const k1_heun = f_ode(mHeun[i], k, mmax);
          // Predictor (m*)
          const m_star = mHeun[i] + k1_heun * h;
          // Corrector (k2)
          const k2_heun = f_ode(m_star, k, mmax);
          // Nuevo valor
          const m_i_heun = mHeun[i] + ((k1_heun + k2_heun) / 2) * h;
          mHeun.push(m_i_heun);

          t.push(t_i + h);
        }

        // Mostrar Resultados
        document.getElementById("ode-t-final").textContent = tFinal.toFixed(2);
        document.getElementById("heun-result").textContent =
          mHeun[mHeun.length - 1].toFixed(5) + " kg";
        document.getElementById("euler-result").textContent =
          mEuler[mEuler.length - 1].toFixed(5) + " kg";

        // Graficar
        if (odeChartInstance) {
          odeChartInstance.destroy();
        }

        const ctx = document.getElementById("odeChart").getContext("2d");
        odeChartInstance = new Chart(ctx, {
          type: "line",
          data: {
            labels: t.map((val) => val.toFixed(1)), // Mostrar el tiempo en el eje X
            datasets: [
              {
                label: "Método de Euler",
                data: mEuler,
                borderColor: "#ab47bc", // Morado Medio
                backgroundColor: "rgba(171, 71, 188, 0.2)",
                borderWidth: 2,
                pointRadius: 0,
                tension: 0.3,
              },
              {
                label: "Método de Heun",
                data: mHeun,
                borderColor: "#6a1b9a", // Morado Oscuro
                backgroundColor: "rgba(106, 27, 154, 0.2)",
                borderWidth: 3,
                pointRadius: 0,
                tension: 0.3,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                title: { display: true, text: "Tiempo (t)", color: "#6a1b9a" },
                ticks: { maxTicksLimit: 15 },
              },
              y: {
                title: { display: true, text: "Masa (m)", color: "#6a1b9a" },
                beginAtZero: true,
                max: mmax * 1.05, // Ligeramente por encima de mmax
              },
            },
            plugins: {
              legend: { position: "top" },
              title: {
                display: true,
                text: "Comparación de Métodos Numéricos para Crecimiento Asintótico",
              },
            },
          },
        });
      }

      // =========================================================
      // 2. MÉTODO DE BISECCIÓN (RAÍCES)
      // =========================================================
      // Función: f(x) = x^3 - 7x^2 + 14x - 6
      const f_bisect = (x) => {
        return Math.pow(x, 3) - 7 * Math.pow(x, 2) + 14 * x - 6;
      };

      function solveBisection() {
        let a = parseFloat(document.getElementById("bisect-a").value);
        let b = parseFloat(document.getElementById("bisect-b").value);
        const tol = parseFloat(document.getElementById("bisect-tol").value);
        const maxIter = parseInt(document.getElementById("bisect-maxit").value);

        if (
          isNaN(a) ||
          isNaN(b) ||
          isNaN(tol) ||
          isNaN(maxIter) ||
          f_bisect(a) * f_bisect(b) >= 0
        ) {
          document.getElementById("bisection-root").textContent = "ERROR";
          document.getElementById("bisection-iter").textContent = "0";
          alert("Verifique límites: f(a) y f(b) deben tener signos opuestos.");
          return;
        }

        let c = a; // Punto medio
        let iter = 0;

        for (iter = 0; iter < maxIter; iter++) {
          c = (a + b) / 2;
          if (f_bisect(c) === 0 || (b - a) / 2 < tol) {
            break;
          }

          if (f_bisect(c) * f_bisect(a) < 0) {
            b = c;
          } else {
            a = c;
          }
        }

        document.getElementById("bisection-root").textContent = c.toFixed(8);
        document.getElementById("bisection-iter").textContent = iter;
      }

      // =========================================================
      // 3. MÉTODO DE GAUSS-SEIDEL (SISTEMAS)
      // =========================================================
      function solveGaussSeidel() {
        // Leer la matriz A (3x3) y el vector B
        const A = [
          [
            parseFloat(document.getElementById("a11").value),
            parseFloat(document.getElementById("a12").value),
            parseFloat(document.getElementById("a13").value),
          ],
          [
            parseFloat(document.getElementById("a21").value),
            parseFloat(document.getElementById("a22").value),
            parseFloat(document.getElementById("a23").value),
          ],
          [
            parseFloat(document.getElementById("a31").value),
            parseFloat(document.getElementById("a32").value),
            parseFloat(document.getElementById("a33").value),
          ],
        ];
        const B = [
          parseFloat(document.getElementById("b1").value),
          parseFloat(document.getElementById("b2").value),
          parseFloat(document.getElementById("b3").value),
        ];

        const tol = parseFloat(document.getElementById("gs-tol").value);
        const maxIter = parseInt(document.getElementById("gs-maxit").value);
        const N = 3;

        let X = [0, 0, 0]; // Valores iniciales
        let X_new = [0, 0, 0];
        let error = Infinity;
        let iter = 0;
        let success = false;

        // Verificar la condición de convergencia: diagonalmente dominante
        for (let i = 0; i < N; i++) {
          let sum_off_diagonal = 0;
          for (let j = 0; j < N; j++) {
            if (i !== j) {
              sum_off_diagonal += Math.abs(A[i][j]);
            }
          }
          if (Math.abs(A[i][i]) <= sum_off_diagonal) {
            alert(
              "Advertencia: La matriz no es estrictamente diagonalmente dominante. La convergencia no está garantizada."
            );
            break;
          }
        }

        for (iter = 0; iter < maxIter; iter++) {
          let max_error = 0;

          for (let i = 0; i < N; i++) {
            let sum = 0;
            for (let j = 0; j < N; j++) {
              if (i !== j) {
                // En Gauss-Seidel, usamos los valores más recientes (X_new)
                // para los índices j < i, y los antiguos (X) para j > i.
                if (j < i) {
                  sum += A[i][j] * X_new[j];
                } else {
                  sum += A[i][j] * X[j];
                }
              }
            }

            if (A[i][i] === 0) {
              alert(
                "Error: La matriz tiene un cero en la diagonal principal (A[" +
                  (i + 1) +
                  "," +
                  (i + 1) +
                  "])."
              );
              return;
            }

            X_new[i] = (B[i] - sum) / A[i][i];

            // Cálculo del error absoluto
            const current_error = Math.abs(X_new[i] - X[i]);
            if (current_error > max_error) {
              max_error = current_error;
            }
          }

          // Actualizar X con los nuevos valores
          X = [...X_new];
          error = max_error;

          if (error < tol) {
            success = true;
            break;
          }
        }

        if (success) {
          document.getElementById("gs-x1").textContent = X[0].toFixed(5);
          document.getElementById("gs-x2").textContent = X[1].toFixed(5);
          document.getElementById("gs-x3").textContent = X[2].toFixed(5);
          document.getElementById("gs-iter").textContent = iter + 1;
        } else {
          document.getElementById("gs-x1").textContent = "No converge";
          document.getElementById("gs-x2").textContent = "No converge";
          document.getElementById("gs-x3").textContent = "No converge";
          document.getElementById("gs-iter").textContent = maxIter;
          alert(
            "El método no convergió en el número máximo de iteraciones. Intente con una matriz diagonalmente dominante."
          );
        }
      }

      // Inicializar la gráfica al cargar la página (con valores por defecto del Ejercicio 41)
      window.onload = function () {
        solveODE();
      };
    </script>
  </body>
</html>
